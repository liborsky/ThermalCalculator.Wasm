<!DOCTYPE html>
<html lang="cs">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Výpočet izolace</title>
    <base href="/" />

    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#0078d4" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="apple-mobile-web-app-title" content="Izolace" />
    <meta name="description" content="Aplikace pro výpočet tepelného odporu a optimalizace tloušťky izolace stavebních konstrukcí" />

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico" />

    <!-- PWA Icons -->
    <link rel="icon" type="image/png" sizes="192x192" href="/icons/icon-192.png" />
    <link rel="icon" type="image/png" sizes="512x512" href="/icons/icon-512.png" />
    <link rel="apple-touch-icon" href="/icons/icon-192.png" />

    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json" />

    <!-- CSS -->
    <link rel="stylesheet" href="css/bootstrap/bootstrap.min.css" />
    <link rel="stylesheet" href="css/site.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">

    <!-- Radzen Blazor CSS - Material Design (FREE) -->
    <link rel="stylesheet" href="_content/Radzen.Blazor/css/material.css">

    <link href="ThermalCalculator.Wasm.styles.css" rel="stylesheet" />
</head>

<body>
    <div id="app">
        <div style="display: flex; align-items: center; justify-content: center; height: 100vh; flex-direction: column;">
            <svg class="loading-progress">
                <circle r="40%" cx="50%" cy="50%" />
                <circle r="40%" cx="50%" cy="50%" />
            </svg>
            <div class="loading-progress-text" style="margin-top: 1rem;">Načítání aplikace...</div>
        </div>
    </div>

    <div id="blazor-error-ui" style="background: #ffebee; color: #c62828; padding: 1rem; display: none; position: fixed; top: 0; left: 0; right: 0; z-index: 10000;">
        <div style="display: flex; align-items: center; gap: 1rem;">
            <span style="font-size: 24px;">⚠️</span>
            <span>Nastala neočekávaná chyba. Zkuste prosím obnovit stránku.</span>
        </div>
        <div style="display: flex; gap: 0.5rem; margin-top: 0.5rem;">
            <a href="" class="reload" style="background: #0078d4; color: white; padding: 0.5rem 1rem; border-radius: 4px; text-decoration: none;">Obnovit</a>
            <a class="dismiss" style="background: #6c757d; color: white; padding: 0.5rem 1rem; border-radius: 4px; cursor: pointer;">Zavřít</a>
        </div>
    </div>

    <!-- Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Blazor WebAssembly -->
    <script src="_framework/blazor.webassembly.js"></script>

    <!-- Radzen Blazor JS -->
    <script src="_content/Radzen.Blazor/Radzen.Blazor.js"></script>

    <!-- App utility functions (localStorage, drag&drop, modals) -->
    <script src="js/app.js"></script>

    <!-- Three.js for 3D visualization -->
    <script src="js/three.min.js"></script>
    <script src="js/orbit-controls.js"></script>
    <script src="js/wall-visualization-3d.js"></script>

    <!-- Chart.js and optimization chart -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@3.0.1"></script>
    <script src="js/optimization-chart.js"></script>

    <!-- pdfmake for PDF generation with Czech support -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js"></script>
    <script src="js/pdfGenerator.js"></script>

    <!-- Access Control - Check token before loading app -->
    <script>
        (function() {
            // Check if access token exists in sessionStorage
            var accessToken = sessionStorage.getItem('app_access_token');

            if (!accessToken || !accessToken.startsWith('authorized_')) {
                // No valid token - block access
                document.getElementById('app').innerHTML = '<div style="display: flex; align-items: center; justify-content: center; height: 100vh; flex-direction: column; font-family: -apple-system, BlinkMacSystemFont, \'Segoe UI\', Roboto, sans-serif;"><h1 style="color: #6c757d;">404</h1><p style="color: #6c757d;">Stránka nenalezena</p></div>';

                // Remove all Blazor scripts to prevent app loading
                var scripts = document.querySelectorAll('script[src*="blazor"], script[src*="_framework"], script[src*="Radzen"]');
                scripts.forEach(function(script) {
                    script.remove();
                });

                return; // Stop execution
            }

            // Token valid - continue with normal app loading
        })();
    </script>

    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('service-worker.js');
        }
    </script>
</body>

</html>
