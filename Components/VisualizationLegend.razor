@using ThermalCalculator.Wasm.Models

<div class="visualization-legend">
    <div class="legend-title">
        <i class="bi bi-palette"></i> Legenda
    </div>
    
    @if (Config.Mode == VisualizationMode.Temperature && WallData?.TemperatureData != null)
    {
        <!-- Teplotní legenda -->
        <div class="temperature-legend">
            <h6 class="mb-2">Teplotní škála</h6>
            <div class="temperature-scale" style="background: @GetTemperatureGradientBackground()"></div>
            <div class="temperature-labels">
                <span>@($"{WallData.TemperatureData.MinTemperature:F1}°C")</span>
                <span>@($"{WallData.TemperatureData.MaxTemperature:F1}°C")</span>
            </div>
            <small class="text-muted">
                Rozpětí: @($"{WallData.TemperatureData.TemperatureRange:F1}°C")
            </small>
        </div>
    }
    
    @if (Config.Mode == VisualizationMode.Materials && WallData?.Layers != null)
    {
        <!-- Materiálová legenda -->
        <div class="material-legend">
            <h6 class="mb-2">Materiály</h6>
            @foreach (var layer in WallData.Layers)
            {
                <div class="material-legend-item">
                    <div class="material-color-box" style="background-color: @layer.VisualProperties.BaseColor"></div>
                    <span>@layer.MaterialName</span>
                </div>
            }
        </div>
    }
    
    @if (Config.ShowCondensationZones && WallData?.CondensationZones?.Any() == true)
    {
        <!-- Kondenzační legenda -->
        <div class="condensation-legend">
            <h6 class="mb-2">Kondenzační riziko</h6>
            <div class="condensation-legend-item">
                <div class="condensation-severity-box severity-none"></div>
                <span>Bez rizika</span>
            </div>
            <div class="condensation-legend-item">
                <div class="condensation-severity-box severity-low"></div>
                <span>Nízké riziko (&lt; 0.5 kg/m²/rok)</span>
            </div>
            <div class="condensation-legend-item">
                <div class="condensation-severity-box severity-medium"></div>
                <span>Střední riziko (0.5-2.0 kg/m²/rok)</span>
            </div>
            <div class="condensation-legend-item">
                <div class="condensation-severity-box severity-high"></div>
                <span>Vysoké riziko (2.0-5.0 kg/m²/rok)</span>
            </div>
            <div class="condensation-legend-item">
                <div class="condensation-severity-box severity-critical"></div>
                <span>Kritické riziko (&gt; 5.0 kg/m²/rok)</span>
            </div>
            
            @if (WallData.CondensationZones.Any())
            {
                <div class="mt-2">
                    <small class="text-danger">
                        <i class="bi bi-exclamation-triangle"></i>
                        <strong>Detekované kondenzační zóny:</strong>
                    </small>
                    @foreach (var zone in WallData.CondensationZones)
                    {
                        <div class="mt-1">
                            <small>
                                <strong>@zone.MaterialName:</strong> 
                                @($"{zone.CondensationAmount:F2} kg/m²/rok")
                                (@GetCondensationSeverityText(zone.Severity))
                            </small>
                        </div>
                    }
                </div>
            }
        </div>
    }
    
    @if (Config.Mode == VisualizationMode.HeatFlow)
    {
        <!-- Tepelný tok legenda -->
        <div class="heat-flow-legend">
            <h6 class="mb-2">Tepelný tok</h6>
            <div class="d-flex align-items-center gap-2 mb-2">
                <i class="bi bi-arrow-right text-primary"></i>
                <span>Směr tepelného toku</span>
            </div>
            <small class="text-muted">
                Teplo proudí z teplejší strany (vnitřek) na chladnější stranu (vnějšek).
                Intenzita je znázorněna barvou a rychlostí animace.
            </small>
        </div>
    }
    
    @if (Config.Mode == VisualizationMode.Dimensional && WallData?.Layers != null)
    {
        <!-- Rozměrová legenda -->
        <div class="dimensional-legend">
            <h6 class="mb-2">Rozměry vrstev</h6>
            @foreach (var (layer, index) in WallData.Layers.Select((l, i) => (l, i)))
            {
                <div class="d-flex justify-content-between align-items-center mb-1">
                    <span class="small">@($"{index + 1}. {layer.MaterialName}")</span>
                    <span class="badge bg-secondary">@($"{layer.Thickness:F0} mm")</span>
                </div>
            }
            <hr class="my-2">
            <div class="d-flex justify-content-between align-items-center">
                <strong>Celková tloušťka:</strong>
                <strong class="text-primary">@($"{WallData.TotalThickness:F0} mm")</strong>
            </div>
        </div>
    }
    
    <!-- Obecné informace -->
    <div class="mt-3 pt-3 border-top">
        <h6 class="mb-2">Obecné informace</h6>
        
        @if (WallData != null)
        {
            <div class="info-item">
                <span class="info-label">Aktuální mód:</span>
                <span class="info-value">@GetModeDisplayName(Config.Mode)</span>
            </div>
            
            @if (Config.Mode == VisualizationMode.Temperature)
            {
                <div class="info-item">
                    <span class="info-label">Barevné schéma:</span>
                    <span class="info-value">@GetColorSchemeDisplayName(Config.TemperatureColorScheme)</span>
                </div>
            }
            
            <div class="info-item">
                <span class="info-label">Klimatické podmínky:</span>
                <span class="info-value">
                    @($"Vnitřek: {WallData.Climate.InternalTemperature:F0}°C, {WallData.Climate.InternalHumidity:F0}%")
                </span>
            </div>
            <div class="info-item">
                <span class="info-label"></span>
                <span class="info-value">
                    @($"Venku: {WallData.Climate.ExternalTemperature:F0}°C, {WallData.Climate.ExternalHumidity:F0}%")
                </span>
            </div>
        }
        
        @if (Config.EnableAnimation)
        {
            <div class="info-item">
                <span class="info-label">Animace:</span>
                <span class="info-value">@($"Rychlost {Config.AnimationSpeed:F1}x")</span>
            </div>
        }
    </div>
    
    <!-- Nápověda pro interpretaci -->
    <div class="mt-3 pt-3 border-top">
        <h6 class="mb-2"><i class="bi bi-lightbulb"></i> Interpretace výsledků</h6>
        <div class="alert alert-info py-2 px-3 mb-2">
            <small>
                @if (Config.Mode == VisualizationMode.Temperature)
                {
                    <text>
                        <strong>Teplotní gradient:</strong> Modré oblasti jsou chladnější, 
                        červené teplejší. Prudké změny barev znamenají materiály s vysokým 
                        tepelným odporem (dobré izolátory).
                    </text>
                }
                else if (Config.Mode == VisualizationMode.Condensation)
                {
                    <text>
                        <strong>Kondenzace:</strong> Červené oblasti označují místa s rizikem 
                        kondenzace vodní páry. Žluté a oranžové oblasti vyžadují pozornost.
                    </text>
                }
                else if (Config.Mode == VisualizationMode.Materials)
                {
                    <text>
                        <strong>Materiály:</strong> Každá barva představuje jiný typ materiálu. 
                        Tloušťka vrstev je proporcionální skutečným rozměrům.
                    </text>
                }
                else if (Config.Mode == VisualizationMode.HeatFlow)
                {
                    <text>
                        <strong>Tepelný tok:</strong> Animace ukazuje směr a rychlost prostupu tepla 
                        konstrukcí. Rychlejší animace znamená větší tepelný tok.
                    </text>
                }
                else
                {
                    <text>
                        <strong>3D model:</strong> Interaktivní zobrazení řezu zdí s možností 
                        rotace, přiblížení a detailního prozkoumání jednotlivých vrstev.
                    </text>
                }
            </small>
        </div>
        
        <!-- Praktické tipy -->
        <div class="alert alert-warning py-2 px-3 mb-0">
            <small>
                <strong><i class="bi bi-exclamation-triangle"></i> Praktické tipy:</strong><br>
                • <strong>Tepelné mosty:</strong> Hledejte místa s vysokým gradientem<br>
                • <strong>Kondenzace:</strong> Kritické jsou styky různých materiálů<br>
                • <strong>Izolace:</strong> Nejsilnější vrstvy by měly mít nejnižší λ<br>
                • <strong>Difuze:</strong> Kontrolujte směr difuze z vnitřku ven
            </small>
        </div>
    </div>
</div>

@code {
    [Parameter] public VisualizationConfig Config { get; set; } = new();
    [Parameter] public WallVisualizationData? WallData { get; set; }

    private string GetTemperatureGradientBackground()
    {
        return Config.TemperatureColorScheme switch
        {
            ThermalCalculator.Wasm.Models.ColorScheme.BlueRedScale => "linear-gradient(to right, #0066cc, #4d9dff, #80ccff, #ffcc80, #ff9900, #ff0000)",
            ThermalCalculator.Wasm.Models.ColorScheme.Rainbow => "linear-gradient(to right, #0066cc, #00cc66, #cccc00, #cc6600, #cc0000)",
            ThermalCalculator.Wasm.Models.ColorScheme.Thermal => "linear-gradient(to right, #000066, #0066cc, #00cccc, #cccc00, #cc6600, #cc0000)",
            ThermalCalculator.Wasm.Models.ColorScheme.Monochrome => "linear-gradient(to right, #000000, #404040, #808080, #c0c0c0, #ffffff)",
            _ => "linear-gradient(to right, #0066cc, #ff0000)"
        };
    }

    private string GetModeDisplayName(VisualizationMode mode)
    {
        return mode switch
        {
            VisualizationMode.Temperature => "Teplotní gradient",
            VisualizationMode.Materials => "Materiálové vrstvy",
            VisualizationMode.Condensation => "Kondenzační analýza",
            VisualizationMode.HeatFlow => "Tepelný tok",
            VisualizationMode.Dimensional => "Rozměrové zobrazení",
            _ => "Neznámý"
        };
    }

    private string GetColorSchemeDisplayName(ThermalCalculator.Wasm.Models.ColorScheme scheme)
    {
        return scheme switch
        {
            ThermalCalculator.Wasm.Models.ColorScheme.BlueRedScale => "Modra-Červená",
            ThermalCalculator.Wasm.Models.ColorScheme.Rainbow => "Duha spektrum",
            ThermalCalculator.Wasm.Models.ColorScheme.Thermal => "Tepelná kamera",
            ThermalCalculator.Wasm.Models.ColorScheme.Monochrome => "Černobílé",
            _ => "Neznámé"
        };
    }

    private string GetCondensationSeverityText(CondensationSeverity severity)
    {
        return severity switch
        {
            CondensationSeverity.None => "Bez rizika",
            CondensationSeverity.Low => "Nízké riziko",
            CondensationSeverity.Medium => "Střední riziko",
            CondensationSeverity.High => "Vysoké riziko",
            CondensationSeverity.Critical => "Kritické riziko",
            _ => "Neznámé"
        };
    }
}